@{
    ViewData["Title"] = "Ürünler";
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] – Renart</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Ürünler</h1>
        <div id="product-list" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
    </div>

    <script type="module">
        const colorMeta = {
          yellow: { label: "Yellow Gold", hex: "#E6CA97" },
          white:  { label: "White Gold",  hex: "#D9D9D9" },
          rose:   { label: "Rose Gold",   hex: "#E1A4A9" }
        };

        async function load() {
          const res   = await fetch("/products");
          const items = await res.json();
          const list  = document.getElementById("product-list");

          items.forEach((p, index) => {
            const colors = Object.keys(p.images);
            const slides = colors.map(c => `
              <div class="swiper-slide">
                <img src="${p.images[c]}" class="w-full h-48 object-cover rounded" />
              </div>`).join("");

            const buttons = colors.map((c, i) => `
              <button data-index="${i}" data-color="${c}"
                      class="color-btn w-5 h-5 rounded-full border ${i===0?'ring-2 ring-blue-500':''}"
                      style="background-color:${colorMeta[c].hex}"></button>`).join("");

            const wrapperId = `swiper-${index}`;
            const rating = p.popularityOutOf5;

            const fullStars = Math.floor(rating);
            const emptyStars = 5 - fullStars;

            const starsHtml =
              `${'★'.repeat(fullStars)}${'☆'.repeat(emptyStars)} <span class="text-sm ml-1">${rating}/5</span>`;

            const currentLabel = `${colorMeta[colors[0]].label}`;

            const card = document.createElement("div");
            card.className = "bg-white p-4 rounded shadow";
            card.innerHTML = `
              <div class="swiper mb-2" id="${wrapperId}">
                <div class="swiper-wrapper">${slides}</div>
              </div>
              <h2 class="font-semibold">${p.name}</h2>
              <p class="text-sm text-gray-600">Fiyat: $${p.priceUSD}</p>
              <div class="flex justify-center gap-2 mt-2">${buttons}</div>
              <p class="text-xs mt-1 text-gray-500 color-label">${currentLabel}</p>
              <div class="mt-2 text-yellow-500 text-sm">${starsHtml}</div>
            `;
            list.appendChild(card);

            const swiper = new Swiper(`#${wrapperId}`, { loop:true, navigation:true });

            card.querySelectorAll(".color-btn").forEach(btn => {
              btn.addEventListener("click", () => {
                card.querySelectorAll(".color-btn").forEach(b =>
                  b.classList.remove("ring-2","ring-blue-500"));
                btn.classList.add("ring-2","ring-blue-500");

                const idx = Number(btn.dataset.index);
                swiper.slideToLoop(idx);

                const meta = colorMeta[btn.dataset.color];
                card.querySelector(".color-label").textContent = `${meta.label}`;
              });
            });
          });
        }

        load();
    </script>
</body>
</html>
